var ChargeItemRegistry;LIBRARY({name:"ChargeItem",version:10,shared:!0,api:"CoreEngine"}),function(e){function r(r,a,n,i,g,o,u){if("string"==typeof a)e.chargeData[r]={canProvideEnergy:o,energy:a,tier:g||0,maxCharge:n,transferLimit:i};else{var c=a;e.chargeData[r]=c,u=n,n=c.maxCharge}Item.setMaxDamage(r,27),(null==u||u)&&t(r,n)}function t(e,r){var t=a(e);t&&Item.addToCreative(e,1,g(r,t.maxCharge),(new ItemExtraData).putInt("energy",r))}function a(r){return e.chargeData[r]}function n(e){var r=a(e);return r&&!!r.amount}function i(e,r,t){var n=a(e);return n&&!n.amount&&n.energy==r&&n.tier<=t}function g(e,r){return Math.round((r-e)/r*26+1)}function o(e,r){var t=a(e.id);return!t||r&&t.energy!=r?0:t.amount?t.amount:e.extra?e.extra.getInt("energy"):(e.data<1&&(e.data=1),e.data>27&&(e.data=27),Math.round((27-e.data)/26*t.maxCharge))}function u(e,r){var t=a(e.id);t&&(e.extra||(e.extra=new ItemExtraData),e.extra.putInt("energy",r),e.data=g(r,t.maxCharge))}function c(e,r,t,n,i){var g=a(e.id);if(!g||g.energy!=r||g.tier>n||!g.canProvideEnergy)return 0;if(g.amount)return t<1?0:(e.count--,e.count<1&&(e.id=e.data=0),g.amount);if(g.onDischarge)return g.onDischarge(e,t,n,i);i||(t=Math.min(t,g.transferLimit));var c=o(e),d=Math.min(t,c);return u(e,c-d),d}function d(e,r,t,n,g){var c=a(e.id);if(!c||!i(e.id,r,n))return 0;if(c.onCharge)return c.onCharge(e,t,n,g);g||(t=Math.min(t,c.transferLimit));var d=o(e),m=Math.min(t,c.maxCharge-d);return u(e,d+m),m}e.chargeData={},e.registerItem=r,e.registerFlashItem=function(r,t,a,n){void 0===n&&(n=0),e.chargeData[r]={canProvideEnergy:!0,tier:n,energy:t,amount:a}},e.registerExtraItem=function(e,t,a,n,i,g,o,u){r(e,t,a,n,i,!!g,!u)},e.addToCreative=t,e.registerChargeFunction=function(r,t){e.chargeData[r].onCharge=t},e.registerDischargeFunction=function(r,t){e.chargeData[r].onDischarge=t},e.getItemData=a,e.isFlashStorage=n,e.isValidItem=i,e.isValidStorage=function(e,r,t){var n=a(e);return n&&n.canProvideEnergy&&n.energy==r&&n.tier<=t},e.getMaxCharge=function(e,r){var t=a(e);return!t||r&&t.energy!=r?0:t.maxCharge},e.getDisplayData=g,e.getEnergyStored=o,e.setEnergyStored=u,e.getEnergyFrom=c,e.getEnergyFromSlot=function(e,r,t,a,n){var i=c(e,r,t,a,n);return e.setSlot(e.id,e.count,e.data,e.extra),i},e.addEnergyTo=d,e.addEnergyToSlot=function(e,r,t,a,n){var i=d(e,r,t,a,n);return e.setSlot(e.id,e.count,e.data,e.extra),i},e.transferEnergy=function(e,r,t){var i=a(t.id),g=0;for(var u in r)n(r[u].id)||(g+=o(r[u],i.energy)),e.decreaseFieldSlot(u);d(t,i.energy,g,i.tier,!0)}}(ChargeItemRegistry||(ChargeItemRegistry={})),EXPORT("ChargeItemRegistry",ChargeItemRegistry);